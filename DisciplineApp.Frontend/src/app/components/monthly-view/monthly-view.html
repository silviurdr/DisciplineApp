<!-- monthly-view.component.html -->
<div class="monthly-view">
  <!-- Header -->
  <div class="month-header">
    <button class="nav-btn" (click)="previousMonth()" [disabled]="loading">
      â€¹
    </button>
    <div class="month-info">
      <h2>{{ getMonthName() }} {{ currentYear }}</h2>
      <button class="today-btn" (click)="goToToday()" [disabled]="loading">
        Today
      </button>
    </div>
    <button class="nav-btn" (click)="nextMonth()" [disabled]="loading">
      â€º
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading calendar...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-state">
    <p>{{ error }}</p>
    <button (click)="loadMonthData()" class="retry-btn">Retry</button>
  </div>

  <!-- Stats Overview -->
  <div class="stats-overview" *ngIf="monthlyStats && !loading && !error">
    <div class="stat-card completion">
      <div class="stat-value">{{ monthlyStats.completionRate | number:'1.0-1' }}%</div>
      <div class="stat-label">Completion Rate</div>
      <div class="stat-detail">{{ monthlyStats.completedDays }}/{{ monthlyStats.totalDays }} days</div>
    </div>
    
    <div class="stat-card streak">
      <div class="stat-value">{{ monthlyStats.currentStreak }}</div>
      <div class="stat-label">Current Streak</div>
      <div class="stat-detail">consecutive days</div>
    </div>
    
    <div class="stat-card habits">
      <div class="stat-value">{{ monthlyStats.totalHabits }}</div>
      <div class="stat-label">Total Tasks</div>
      <div class="stat-detail">this month</div>
    </div>
  </div>

  <!-- Calendar -->
  <div class="calendar-container" *ngIf="!loading && !error">
    <!-- Day Headers -->
    <div class="calendar-header">
      <div *ngFor="let dayName of getWeekDays()" class="day-header">{{ dayName }}</div>
    </div>

    <!-- Calendar Grid -->
    <div class="calendar-grid">
<div 
  *ngFor="let day of calendarDays" 
  class="calendar-day"
  [class.other-month]="!day.isCurrentMonth"
  [class.today]="day.isToday"
  [class.future]="day.isFuture"
  [class.completed]="day.isCompleted && day.isCurrentMonth && !day.isToday"
  [class.incomplete]="!day.isCompleted && day.isCurrentMonth && !day.isFuture && day.totalHabits > 0 && !day.isToday"
  [class.free-day]="day.totalHabits === 0 && day.isCurrentMonth && !day.isFuture && !day.isBeforeStreakStart"
  [class.ignored-day]="day.isBeforeStreakStart"
  (click)="onDayClick(day)">
        
        <!-- Day Number -->
        <div class="day-number">{{ day.dayNumber }}</div>
        
<!-- Binary Complete/Fail Status Icons for Past Days -->
<div class="status-icon-weekly" *ngIf="day.isCurrentMonth && !day.projectedReward && !day.isBeforeStreakStart">
  
  <!-- TODAY: Always show in-progress (partial diamond) -->
  <span *ngIf="day.isToday && day.totalHabits > 0" class="partial-diamond">â—†</span>
  
  <!-- PAST DAYS: Binary success/failure -->
  <span *ngIf="!day.isToday && !day.isFuture && day.isCompleted" class="completion-check">âœ“</span>
  <span *ngIf="!day.isToday && !day.isFuture && !day.isCompleted && day.totalHabits > 0" class="failure-x">âœ•</span>
  
  <!-- FREE DAYS: No tasks scheduled -->
  <span *ngIf="day.totalHabits === 0 && !day.isFuture" class="free-circle">â—‹</span>
</div>

        <!-- Projected Reward Icon (HIGHEST PRIORITY) -->
        <div class="projected-reward" *ngIf="day.projectedReward">
          <div class="reward-icon" [title]="day.projectedReward.description">
            {{ day.projectedReward.icon }}
          </div>
        </div>
        
<div class="task-count-weekly" 
     *ngIf="day.isCurrentMonth && day.isFuture && day.totalHabits > 0 && !day.projectedReward">
  <span class="count-text">0/{{ day.totalHabits || 0 }}</span>
</div>

        <!-- PRESERVE EXISTING: Progress Display for Days with Tasks -->
<div class="task-summary" 
     *ngIf="day.isCurrentMonth && !day.isFuture && day.totalHabits > 0 && !day.projectedReward && !day.isBeforeStreakStart">
  <div class="task-count">
    {{ day.completedHabits }}/{{ day.totalHabits }}
  </div>
  <div class="completion-bar">
    <div class="completion-fill" 
         [style.width.%]="day.completionPercentage"
         [class.completed-fill]="day.isCompleted && !day.isToday"
         [class.today-fill]="day.isToday"
         [class.incomplete-fill]="!day.isCompleted && !day.isToday">
    </div>
  </div>
</div>
        
        <!-- PRESERVE EXISTING: Status Icon for backup display -->
        <div class="day-status" 
             *ngIf="day.isCurrentMonth && !day.isFuture && !day.projectedReward && !day.isBeforeStreakStart && day.totalHabits === 0">
          <span class="status-icon" [ngClass]="getDayCompletionClass(day)">
            {{ day.totalHabits === 0 ? 'â—‹' : (day.isCompleted ? 'âœ“' : 'âœ•') }}
          </span>
        </div>
        
        <!-- Future State Label -->
        <div class="future-indicator" 
             *ngIf="day.isFuture && day.isCurrentMonth && !day.projectedReward">
          FUTURE
        </div>
        
        <!-- Free Day Label -->
        <div class="free-day" 
             *ngIf="day.totalHabits === 0 && !day.isFuture && day.isCurrentMonth && !day.projectedReward && !day.isBeforeStreakStart">
          FREE
        </div>
        
        <!-- Before Streak Start Indicator -->
        <div class="before-streak" 
             *ngIf="day.isBeforeStreakStart && day.isCurrentMonth">
          -
        </div>
      </div>
    </div>
  </div>

  <!-- PRESERVE EXISTING: Projected Rewards Section -->
  <div class="projected-rewards" *ngIf="projectedRewards.length > 0 && !loading && !error">
    <h4>ðŸŽ¯ Upcoming Rewards</h4>
    <div class="rewards-list">
      <div *ngFor="let reward of projectedRewards" class="reward-item">
        <div class="reward-icon">{{ reward.icon }}</div>
        <div class="reward-info">
          <div class="reward-name">{{ reward.name }}</div>
          <div class="reward-description">{{ reward.description }}</div>
          <div class="reward-progress">{{ reward.daysUntil }} days to go</div>
        </div>
      </div>
    </div>
  </div>

  <!-- PRESERVE EXISTING: Reward Legend -->
  <div class="reward-legend" *ngIf="projectedRewards.length > 0">
    <h4>Reward Types</h4>
    <div class="legend-items">
      <div class="legend-item">
        <span class="legend-icon tier-1">â˜•</span>
        <span>Coffee Reward (7 days)</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon tier-2">ðŸ“š</span>
        <span>Book Reward (14 days)</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon tier-3">ðŸ‘•</span>
        <span>Clothing Reward (30 days)</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon tier-4">ðŸŽ¾</span>
        <span>Equipment Reward (90+ days)</span>
      </div>
    </div>
  </div>
</div>