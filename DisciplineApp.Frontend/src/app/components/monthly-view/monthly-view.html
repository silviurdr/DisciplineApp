<!-- monthly-view.component.html -->
<div class="monthly-view">
  <!-- Header -->
  <div class="month-header">
    <button class="nav-btn" (click)="previousMonth()" [disabled]="loading">
      â€¹
    </button>
    <div class="month-info">
      <h2>{{ getMonthName(currentMonth) }} {{ currentYear }}</h2>
      <button class="today-btn" (click)="goToToday()" [disabled]="loading">
        Today
      </button>
    </div>
    <button class="nav-btn" (click)="nextMonth()" [disabled]="loading">
      â€º
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading calendar...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-state">
    <p>{{ error }}</p>
    <button (click)="loadMonthData()" class="retry-btn">Retry</button>
  </div>

  <!-- Stats Overview -->
  <div class="stats-overview" *ngIf="monthlyStats && !loading && !error">
    <div class="stat-card completion">
      <div class="stat-value">{{ monthlyStats.completionRate }}%</div>
      <div class="stat-label">Completion Rate</div>
      <div class="stat-detail">{{ monthlyStats.completedDays }}/{{ monthlyStats.totalDays }} days</div>
    </div>
    
    <div class="stat-card streak">
      <div class="stat-value">{{ monthlyStats.currentStreak }}</div>
      <div class="stat-label">Current Streak</div>
      <div class="stat-detail">consecutive days</div>
    </div>
    
    <div class="stat-card habits">
      <div class="stat-value">{{ monthlyStats.totalHabits }}</div>
      <div class="stat-label">Total Tasks</div>
      <div class="stat-detail">this month</div>
    </div>
  </div>

  <!-- Calendar -->
  <div class="calendar-container" *ngIf="!loading && !error">
    <!-- Day Headers -->
    <div class="calendar-header">
      <div class="day-header">Sun</div>
      <div class="day-header">Mon</div>
      <div class="day-header">Tue</div>
      <div class="day-header">Wed</div>
      <div class="day-header">Thu</div>
      <div class="day-header">Fri</div>
      <div class="day-header">Sat</div>
    </div>

    <!-- Calendar Grid -->
<div class="calendar-grid">
  <div 
    *ngFor="let day of calendarDays" 
    class="calendar-day"
    [class.other-month]="!day.isCurrentMonth"
    [class.today]="day.isToday"
    [class.future]="day.isFuture"
    [class.has-reward]="getProjectedReward(day) !== null"
    [class]="getDayStatusClass(day)"
    (click)="onDayClick(day)">
    
    <!-- Day Number -->
    <div class="day-number">{{ day.dayNumber }}</div>
    
    <!-- Projected Reward Icon -->
    <div class="projected-reward" *ngIf="getProjectedReward(day) as reward">
      <div class="reward-icon" 
           [style.background-color]="reward.tier.color"
           [title]="getRewardDisplayText(reward)">
        {{ reward.tier.icon }}
      </div>
      <div class="reward-text">
        Day {{ reward.streakDay }}
      </div>
    </div>
    
    <!-- Status Icon -->
    <div class="day-status" *ngIf="day.isCurrentMonth && !day.isFuture && !getProjectedReward(day)">
      <span class="status-icon" [class]="getDayStatusClass(day)">
        {{ getStatusIcon(day) }}
      </span>
    </div>
    
    <!-- Task Summary -->
    <div class="task-summary" *ngIf="day.isCurrentMonth && !day.isFuture && day.totalHabits > 0 && !getProjectedReward(day)">
      <div class="task-count">
        {{ day.completedHabits }}/{{ day.totalHabits }}
      </div>
      <div class="completion-bar">
        <div class="completion-fill" [style.width.%]="day.completionPercentage"></div>
      </div>
    </div>
    
    <!-- Future Indicator -->
    <div class="future-indicator" *ngIf="day.isFuture && day.isCurrentMonth && !getProjectedReward(day)">
      Future
    </div>
    
    <!-- Free Day -->
    <div class="free-day" *ngIf="day.totalHabits === 0 && !day.isFuture && day.isCurrentMonth && !getProjectedReward(day)">
      Free
    </div>
  </div>
</div>
  </div>

  <!-- Add Reward Legend (optional) -->
<div class="reward-legend" *ngIf="projectedRewards.length > 0">
  <h4>Upcoming Rewards</h4>
  <div class="legend-items">
    <div class="legend-item">
      <span class="legend-icon tier-1">â˜•</span>
      <span>Coffee Reward</span>
    </div>
    <div class="legend-item">
      <span class="legend-icon tier-2">ðŸ“š</span>
      <span>Book Reward</span>
    </div>
    <div class="legend-item">
      <span class="legend-icon tier-3">ðŸ‘•</span>
      <span>Clothing Reward</span>
    </div>
    <div class="legend-item">
      <span class="legend-icon tier-4">ðŸŽ¾</span>
      <span>Equipment Reward</span>
    </div>
  </div>
</div>
<button class="debug-btn" (click)="debugRewardsSystem()" 
        style="background: orange; color: black; padding: 10px; margin: 10px; border: none; border-radius: 4px;">
  Debug Rewards System
</button>
</div>