<!-- Complete monthly-view.html file - FIXED with original styling only -->
<div class="monthly-view">
  <!-- Header - FIXED: Only show when not loading -->
  <div class="month-header" *ngIf="!loading && !error">
    <button class="nav-btn" (click)="previousMonth()" [disabled]="loading">
      â€¹
    </button>
    <div class="month-info">
      <h2>{{ getMonthName() }} {{ currentYear }}</h2>
      <button class="today-btn" (click)="goToToday()" [disabled]="loading">
        Today
      </button>
    </div>
    <button class="nav-btn" (click)="nextMonth()" [disabled]="loading">
      â€º
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading calendar...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <p>{{ error }}</p>
    <button (click)="loadMonthDataFromDailyStats()" class="retry-btn">Retry</button>
  </div>

  <!-- Stats Overview - FIXED: Only show when data is loaded -->
  <div class="stats-overview" *ngIf="monthlyStats && !loading && !error">
    <div class="stat-card completion">
      <div class="stat-value">{{ monthlyStats.completionRate | number:'1.0-1' }}%</div>
      <div class="stat-label">Completion Rate</div>
      <div class="stat-detail">{{ monthlyStats.completedDays }}/{{ monthlyStats.totalDays }} days</div>
    </div>
    
    <div class="stat-card streak">
      <div class="stat-value">{{ monthlyStats.currentStreak }}</div>
      <div class="stat-label">Current Streak</div>
      <div class="stat-detail">consecutive days</div>
    </div>
    
    <div class="stat-card habits">
      <div class="stat-value">{{ monthlyStats.totalHabits }}</div>
      <div class="stat-label">Total Tasks</div>
      <div class="stat-detail">this month</div>
    </div>
  </div>

  <!-- Calendar - FIXED: Only show when data is loaded -->
  <div class="calendar-container" *ngIf="!loading && !error && calendarDays.length > 0">
    <!-- Day Headers -->
    <div class="calendar-header">
      <div *ngFor="let dayName of getWeekDays()" class="day-header">{{ dayName }}</div>
    </div>

    <!-- Calendar Grid -->
    <div class="calendar-grid">
      <div 
        *ngFor="let day of calendarDays" 
        class="calendar-day"
        [class.other-month]="!day.isCurrentMonth"
        [class.today]="day.isToday"
        [class.future]="day.isFuture"
        [class.completed]="day.isCompleted && day.isCurrentMonth && !day.isCurrentStreak"
        [class.completed-current-streak]="day.isCompleted && day.isCurrentMonth && day.isCurrentStreak"
        [class.incomplete]="!day.isCompleted && day.isCurrentMonth && !day.isFuture && day.totalHabits > 0 && !day.isToday"
        [class.free-day]="day.totalHabits === 0 && day.isCurrentMonth && !day.isFuture">
        
        <!-- Day Number -->
        <div class="day-number">{{ day.dayNumber }}</div>
        
        <!-- Binary Complete/Fail Status Icons for Past Days -->
        <div class="status-icon-weekly" *ngIf="day.isCurrentMonth && !day.projectedReward">
          
          <!-- TODAY: Always show in-progress (partial diamond) -->
          <span *ngIf="day.isToday && day.totalHabits > 0 && !day.isCompleted" class="partial-diamond">â—†</span>
          
          <!-- PAST DAYS: Binary success/failure -->
          <span *ngIf="!day.isFuture && day.isCompleted" class="completion-check">âœ“</span>
          <span *ngIf="!day.isToday &&!day.isFuture && !day.isCompleted && day.totalHabits > 0" class="failure-x">âœ•</span>
          
          <!-- FREE DAYS: No tasks scheduled -->
          <span *ngIf="day.totalHabits === 0 && !day.isFuture" class="free-circle">â—‹</span>
        </div>

        <!-- Projected Reward Icon (HIGHEST PRIORITY) -->
        <div class="reward-icon-container" *ngIf="day.projectedReward && day.isCurrentMonth">
          <div 
            class="reward-icon"
            [style.color]="day.projectedReward.color"
            [title]="day.projectedReward.description">
            {{ day.projectedReward.icon }}
          </div>
          <div class="reward-day-label">Day {{ day.projectedReward.day }}</div>
        </div>

        <!-- Habit Progress for Current Month Days (when not showing reward) -->
        <div class="habit-progress" *ngIf="day.isCurrentMonth && !day.isFuture && !day.projectedReward && day.totalHabits > 0">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="day.completionPercentage"></div>
          </div>
          <div class="habit-count">{{ day.completedHabits }}/{{ day.totalHabits }}</div>
        </div>

        <!-- Flexibility Usage Badge (for days with deferrals) -->
        <div class="flexibility-badge" *ngIf="day.flexibilityUsage && day.flexibilityUsage.totalDeferrals > 0">
          <span class="flexibility-icon">âš¡</span>
          <span class="flexibility-count">{{ day.flexibilityUsage.totalDeferrals }}</span>
        </div>

        <!-- Future Days indicator -->
        <div class="future-indicator" *ngIf="day.isFuture && day.isCurrentMonth">
          <span class="future-text">â€”</span>
        </div>

        <!-- Before Streak Start indicator -->
      </div>
    </div>
  </div>

  <!-- ORIGINAL Projected Rewards Section - Using proper CSS classes -->
  <div class="projected-rewards" *ngIf="projectedRewards.length > 0 && !loading && !error">
    <h4>Upcoming Rewards ðŸŽ¯</h4>
    <div class="rewards-list">
      <div *ngFor="let reward of projectedRewards" class="reward-item">
        <div class="reward-icon" [style.color]="reward.color">{{ reward.icon }}</div>
        <div class="reward-info">
          <div class="reward-name">{{ reward.name }}</div>
          <div class="reward-description">{{ reward.description }}</div>
          <div class="reward-progress">{{ reward.daysUntil }} days until reward</div>
        </div>
      </div>
    </div>
  </div>

<div class="reward-types">
  <div class="reward-legend">
    <h3 class="reward-title">Reward Types</h3>
    <div class="reward-items">
      <div class="reward-item" *ngFor="let rewardType of rewardTypesList">
        <div class="reward-icon-wrapper" (click)="consumeReward(rewardType.name)">
          <span class="reward-icon" [style.color]="rewardType.color">
            {{ rewardType.icon }}
          </span>
          
          <!-- Consumable badge -->
<div class="reward-badge" *ngIf="true">
  +{{ getRewardCountValue(rewardType.name) }}
</div>
        </div>
        
        <span class="reward-text">
          {{ rewardType.name }} ({{ rewardType.days }} days)
        </span>
      </div>
    </div>
  </div>
</div>
<!-- 
  <-- ORIGINAL Reward Legend - All 6 tiers with proper days -->
<!--   <div class="reward-legend" *ngIf="!loading && !error">
    <h4>Reward Types</h4>
    <div class="legend-items">
      <div class="legend-item">
        <span class="legend-icon tier-1">â˜•</span>
        <span>Coffee Reward (7 days)</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon tier-2">ðŸ“š</span>
        <span>Book Reward (14 days)</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon tier-3">ðŸ‘•</span>
        <span>Clothing Reward (30 days)</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon tier-4">ðŸŽ§</span>
        <span>Head Phones (60 days)</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon tier-5">ðŸŽ¾</span>
        <span>Tennis Reward (90+ days)</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon tier-6">ðŸŽ«</span>
        <span>Concert Ticket (180+ days)</span>
      </div>
    </div>
  </div> -->
</div>