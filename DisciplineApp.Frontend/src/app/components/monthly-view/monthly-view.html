<!-- monthly-view.component.html -->
<div class="monthly-view">
  <!-- Header -->
  <div class="month-header">
    <button class="nav-btn" (click)="previousMonth()" [disabled]="loading">
      ‹
    </button>
    <div class="month-info">
      <h2>{{ getMonthName() }} {{ currentYear }}</h2>
      <button class="today-btn" (click)="goToToday()" [disabled]="loading">
        Today
      </button>
    </div>
    <button class="nav-btn" (click)="nextMonth()" [disabled]="loading">
      ›
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading calendar...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-state">
    <p>{{ error }}</p>
    <button (click)="loadMonthData()" class="retry-btn">Retry</button>
  </div>

  <!-- Stats Overview -->
  <div class="stats-overview" *ngIf="monthlyStats && !loading && !error">
    <div class="stat-card completion">
      <div class="stat-value">{{ monthlyStats.completionRate | number:'1.0-1' }}%</div>
      <div class="stat-label">Completion Rate</div>
      <div class="stat-detail">{{ monthlyStats.completedDays }}/{{ monthlyStats.totalDays }} days</div>
    </div>
    
    <div class="stat-card streak">
      <div class="stat-value">{{ monthlyStats.currentStreak }}</div>
      <div class="stat-label">Current Streak</div>
      <div class="stat-detail">consecutive days</div>
    </div>
    
    <div class="stat-card habits">
      <div class="stat-value">{{ monthlyStats.totalHabits }}</div>
      <div class="stat-label">Total Tasks</div>
      <div class="stat-detail">this month</div>
    </div>
  </div>

  <!-- Calendar -->
  <div class="calendar-container" *ngIf="!loading && !error">
    <!-- Day Headers -->
    <div class="calendar-header">
      <div *ngFor="let dayName of getWeekDays()" class="day-header">{{ dayName }}</div>
    </div>

    <!-- Calendar Grid -->
<div class="calendar-grid">
  <div 
    *ngFor="let day of calendarDays" 
    class="calendar-day"
    [class.other-month]="!day.isCurrentMonth"
    [class.today]="day.isToday"
    [class.future]="day.isFuture"
    [class.completed]="day.isCompleted"
    [class.partial]="day.isPartiallyCompleted"
    [class.incomplete]="!day.isCompleted && !day.isPartiallyCompleted && day.isCurrentMonth && !day.isFuture && day.totalHabits > 0"
    [class.ignored-day]="day.isBeforeStreakStart"
    (click)="onDayClick(day)">
    
    <!-- Day Number -->
    <div class="day-number">{{ day.dayNumber }}</div>
    
    <!-- Projected Reward Icon (highest priority) -->
    <div class="projected-reward" *ngIf="day.projectedReward">
      <div class="reward-icon" [title]="day.projectedReward.description">
        {{ day.projectedReward.icon }}
      </div>
    </div>
    
    <!-- Progress Display for Days with Tasks (shows completion like 6/8) -->
    <div class="task-summary" 
         *ngIf="day.isCurrentMonth && !day.isFuture && day.totalHabits > 0 && !day.projectedReward && !day.isBeforeStreakStart">
      <div class="task-count">
        {{ day.completedHabits }}/{{ day.totalHabits }}
      </div>
      <div class="completion-bar">
        <div class="completion-fill" 
             [style.width.%]="day.completionPercentage"
             [class.completed-fill]="day.isCompleted"
             [class.partial-fill]="day.isPartiallyCompleted"
             [class.incomplete-fill]="!day.isCompleted && !day.isPartiallyCompleted">
        </div>
      </div>
    </div>
    
    <!-- Status Icon for Completed/Partial Days (backup display) -->
    <div class="day-status" 
         *ngIf="day.isCurrentMonth && !day.isFuture && !day.projectedReward && !day.isBeforeStreakStart && day.totalHabits === 0">
      <span class="status-icon" [ngClass]="getDayCompletionClass(day)">
        {{ day.isCompleted ? '✓' : day.isPartiallyCompleted ? '◐' : '○' }}
      </span>
    </div>
    
    <!-- Future Indicator -->
    <div class="future-indicator" 
         *ngIf="day.isFuture && day.isCurrentMonth && !day.projectedReward">
      Future
    </div>
    
    <!-- Free Day (no tasks scheduled) -->
    <div class="free-day" 
         *ngIf="day.totalHabits === 0 && !day.isFuture && day.isCurrentMonth && !day.projectedReward && !day.isBeforeStreakStart">
      Free
    </div>
    
    <!-- Before Streak Start Indicator -->
    <div class="before-streak" 
         *ngIf="day.isBeforeStreakStart && day.isCurrentMonth">
      -
    </div>
  </div>
</div>
  </div>

  <!-- Projected Rewards Section -->
  <div class="projected-rewards" *ngIf="projectedRewards.length > 0 && !loading && !error">
    <h4>🎯 Upcoming Rewards</h4>
    <div class="rewards-list">
      <div *ngFor="let reward of projectedRewards" class="reward-item">
        <div class="reward-icon">{{ reward.icon }}</div>
        <div class="reward-info">
          <div class="reward-name">{{ reward.name }}</div>
          <div class="reward-description">{{ reward.description }}</div>
          <div class="reward-progress">{{ reward.daysUntil }} days to go</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Reward Legend -->
  <div class="reward-legend" *ngIf="projectedRewards.length > 0">
    <h4>Reward Types</h4>
    <div class="legend-items">
      <div class="legend-item">
        <span class="legend-icon tier-1">☕</span>
        <span>Coffee Reward (7 days)</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon tier-2">📚</span>
        <span>Book Reward (14 days)</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon tier-3">👕</span>
        <span>Clothing Reward (30 days)</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon tier-4">🎾</span>
        <span>Equipment Reward (90+ days)</span>
      </div>
    </div>
  </div>
</div>