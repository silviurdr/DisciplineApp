<!-- Enhanced habit-management.component.html with Sub-Habits -->
<div class="habit-management-container">
  
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <span>Loading habits...</span>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-alert">
    <span class="error-icon">âŒ</span>
    <span class="error-message">{{ error }}</span>
    <button class="retry-btn" (click)="loadHabits()" [disabled]="loading">
      Retry
    </button>
  </div>

  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>Habits Management</h1>
      <p>Organize your habits and sub-tasks for better discipline tracking</p>
    </div>
    <button class="add-habit-btn" (click)="openAddForm()" [disabled]="loading">
      <span class="btn-icon">â•</span>
      Add New Habit
    </button>
  </div>

  <!-- Add/Edit Form Modal -->
  <div *ngIf="showAddForm" class="modal-overlay" (click)="closeForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ editingHabit ? 'Edit Habit' : 'Add New Habit' }}</h2>
        <button class="close-btn" (click)="closeForm()">âœ•</button>
      </div>
      
      <form [formGroup]="habitForm" (ngSubmit)="saveHabit()" class="habit-form">
        <div class="form-row">
          <div class="form-group full-width">
            <label for="name">Habit Name *</label>
            <input
              id="name"
              type="text"
              formControlName="name"
              placeholder="Enter habit name..."
              [class.error]="habitForm.get('name')?.invalid && habitForm.get('name')?.touched">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label for="description">Description</label>
            <textarea
              id="description"
              formControlName="description"
              placeholder="Describe this habit..."
              rows="3">
            </textarea>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="frequency">Frequency *</label>
            <select id="frequency" formControlName="frequency">
              <option value="Daily">Daily</option>
              <option value="EveryTwoDays">Every 2 Days</option>
              <option value="Weekly">Weekly</option>
              <option value="Monthly">Monthly</option>
              <option value="Seasonal">Seasonal</option>
            </select>
          </div>

          <div class="form-group">
            <label for="estimatedDuration">Duration (minutes)</label>
            <input
              id="estimatedDuration"
              type="number"
              formControlName="estimatedDurationMinutes"
              placeholder="0"
              min="0">
          </div>
        </div>

        <!-- Frequency-specific targets -->
        <div class="form-row" *ngIf="habitForm.get('frequency')?.value === 'Weekly'">
          <div class="form-group">
            <label for="weeklyTarget">Weekly Target</label>
            <input
              id="weeklyTarget"
              type="number"
              formControlName="weeklyTarget"
              placeholder="0"
              min="0"
              max="7">
          </div>
        </div>

        <div class="form-row" *ngIf="habitForm.get('frequency')?.value === 'Monthly'">
          <div class="form-group">
            <label for="monthlyTarget">Monthly Target</label>
            <input
              id="monthlyTarget"
              type="number"
              formControlName="monthlyTarget"
              placeholder="0"
              min="0">
          </div>
        </div>

        <div class="form-row" *ngIf="habitForm.get('frequency')?.value === 'Seasonal'">
          <div class="form-group">
            <label for="seasonalTarget">Seasonal Target</label>
            <input
              id="seasonalTarget"
              type="number"
              formControlName="seasonalTarget"
              placeholder="0"
              min="0">
          </div>
        </div>

        <!-- Deadline Configuration -->
        <div class="form-row">
          <div class="form-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="hasDeadline">
              <span class="checkmark"></span>
              Has deadline time
            </label>
          </div>

          <div class="form-group" *ngIf="habitForm.get('hasDeadline')?.value">
            <label for="deadlineTime">Deadline Time</label>
            <input
              id="deadlineTime"
              type="time"
              formControlName="deadlineTime">
          </div>
        </div>

        <!-- Optional Settings -->
        <div class="form-row">
          <div class="form-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="isOptional">
              <span class="checkmark"></span>
              Optional habit (won't affect streak)
            </label>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-cancel" (click)="closeForm()">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="habitForm.invalid || loading">
            {{ editingHabit ? 'Update Habit' : 'Create Habit' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Habits List -->
  <div class="habits-container" *ngIf="!loading">
    
    <!-- Daily Habits -->
    <div class="habit-category" *ngIf="getDailyHabits().length > 0">
      <div class="category-header">
        <h2>Daily Habits</h2>
        <span class="habit-count">{{ getDailyHabits().length }}</span>
      </div>
      
      <div class="habits-grid">
        <div *ngFor="let habit of getDailyHabits()" class="habit-card daily">
          
          <!-- Habit Header -->
          <div class="habit-header">
            <div class="habit-name-section">
              <div class="habit-name">{{ habit.name }}</div>
              <button 
                class="expand-btn"
                [class.expanded]="isHabitExpanded(habit.id)"
                (click)="toggleHabitExpansion(habit.id)"
                title="Toggle sub-habits">
                <span class="expand-icon">{{ isHabitExpanded(habit.id) ? 'â–¼' : 'â–¶' }}</span>
                <span class="sub-count">({{ habit.subHabits?.length || 0 }})</span>
              </button>
            </div>
            <div class="habit-status">
              <span class="status-badge" [class.active]="habit.isActive" [class.paused]="!habit.isActive">
                {{ habit.isActive ? 'ACTIVE' : 'PAUSED' }}
              </span>
            </div>
          </div>
          
          <div class="habit-description" *ngIf="habit.description">{{ habit.description }}</div>
        <div class="habit-deadline" *ngIf="habit.hasDeadline && habit.deadlineTime">
          <span class="deadline-label">Deadline:</span>
          <span class="deadline-time">{{ formatDeadlineTime(habit.deadlineTime) }}</span>
        </div>
          <div class="habit-meta">
            <div class="frequency-info">Daily</div>
            <div class="duration-info" *ngIf="habit.estimatedDurationMinutes">
              <span class="duration-icon">â±</span>
              {{ formatDuration(habit.estimatedDurationMinutes) }}
            </div>
          </div>
          
          <!-- Sub-Habits Section (Collapsible) -->
          <div *ngIf="isHabitExpanded(habit.id)" class="sub-habits-section">
            <div class="sub-habits-header">
              <h4>Sub-Tasks</h4>
              <button class="add-sub-habit-btn" (click)="showAddSubHabitForm(habit.id)">
                <span class="btn-icon">â•</span>
                Add Sub-Task
              </button>
            </div>
            
            <!-- Add/Edit Sub-Habit Form -->
            <div *ngIf="showSubHabitForm[habit.id]" class="sub-habit-form">
              <form [formGroup]="subHabitForm" (ngSubmit)="saveSubHabit(habit.id)" class="form-inline">
                <div class="form-group">
                  <input
                    type="text"
                    formControlName="name"
                    placeholder="Sub-task name..."
                    [class.error]="subHabitForm.get('name')?.invalid && subHabitForm.get('name')?.touched">
                </div>
                <div class="form-group">
                  <input
                    type="text"
                    formControlName="description"
                    placeholder="Description (optional)...">
                </div>
                <div class="form-actions-inline">
                  <button type="submit" class="btn btn-sm btn-primary" [disabled]="subHabitForm.invalid">
                    {{ editingSubHabit ? 'Update' : 'Add' }}
                  </button>
                  <button type="button" class="btn btn-sm btn-cancel" (click)="hideAddSubHabitForm(habit.id)">
                    Cancel
                  </button>
                </div>
              </form>
            </div>
            
            <!-- Sub-Habits List -->
            <div class="sub-habits-list" *ngIf="habit.subHabits && habit.subHabits.length > 0">
              <div *ngFor="let subHabit of habit.subHabits" class="sub-habit-item" [class.inactive]="!subHabit.isActive">
                <div class="sub-habit-content">
                  <div class="sub-habit-name">{{ subHabit.name }}</div>
                  <div class="sub-habit-description" *ngIf="subHabit.description">{{ subHabit.description }}</div>
                </div>
                <div class="sub-habit-actions">
                  <button class="action-btn edit-btn" (click)="openEditSubHabitForm(habit, subHabit)" title="Edit sub-habit">
                    âœ
                  </button>
                  <button class="action-btn toggle-btn" 
                          [class.active]="subHabit.isActive"
                          (click)="toggleSubHabitActive(habit, subHabit)" 
                          [title]="subHabit.isActive ? 'Deactivate sub-habit' : 'Activate sub-habit'">
                    {{ subHabit.isActive ? 'â¸' : 'â–¶' }}
                  </button>
                  <button class="action-btn delete-btn" (click)="confirmDeleteSubHabit(habit, subHabit)" title="Delete sub-habit">
                    ğŸ—‘
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="habit-actions">
            <button class="action-btn sub-habits-btn" 
                    (click)="openSubHabitsManager(habit.id)"
                    title="Manage sub-habits">
              <span class="btn-icon">ğŸ“‹</span>
              Sub-Tasks
            </button>
            <button class="action-btn edit-btn" (click)="openEditForm(habit)" title="Edit habit">
              âœ
            </button>
            <button class="action-btn toggle-btn" 
                    [class.active]="habit.isActive"
                    (click)="toggleHabitActive(habit)" 
                    [title]="habit.isActive ? 'Pause habit' : 'Activate habit'">
              {{ habit.isActive ? 'â¸' : 'â–¶' }}
            </button>
            <button class="action-btn delete-btn" (click)="confirmDeleteHabit(habit)" title="Delete habit">
              ğŸ—‘
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Rolling Habits -->
    <div class="habit-category" *ngIf="getRollingHabits().length > 0">
      <div class="category-header">
        <h2>Rolling Habits</h2>
        <span class="habit-count">{{ getRollingHabits().length }}</span>
      </div>
      
      <div class="habits-grid">
        <div *ngFor="let habit of getRollingHabits()" class="habit-card rolling">
          
          <!-- Habit Header -->
          <div class="habit-header">
            <div class="habit-name-section">
              <div class="habit-name">{{ habit.name }}</div>
              <button 
                *ngIf="habit.hasSubHabits" 
                class="expand-btn"
                [class.expanded]="isHabitExpanded(habit.id)"
                (click)="toggleHabitExpansion(habit.id)"
                title="Toggle sub-habits">
                <span class="expand-icon">{{ isHabitExpanded(habit.id) ? 'â–¼' : 'â–¶' }}</span>
                <span class="sub-count">({{ habit.subHabits?.length || 0 }})</span>
              </button>
            </div>
            <div class="habit-status">
              <span class="status-badge" [class.active]="habit.isActive" [class.paused]="!habit.isActive">
                {{ habit.isActive ? 'ACTIVE' : 'PAUSED' }}
              </span>
            </div>
          </div>
          
          <div class="habit-description" *ngIf="habit.description">{{ habit.description }}</div>
          
          <div class="habit-meta">
            <div class="frequency-info">Every 2 days</div>
            <div class="duration-info" *ngIf="habit.estimatedDurationMinutes">
              <span class="duration-icon">â±</span>
              {{ formatDuration(habit.estimatedDurationMinutes) }}
            </div>
            <div class="deadline-info" *ngIf="habit.hasDeadline">{{ habit.deadlineTime }}</div>
          </div>
          
          <!-- Sub-Habits Section (Collapsible) -->
          <div *ngIf="habit.hasSubHabits && isHabitExpanded(habit.id)" class="sub-habits-section">
            <div class="sub-habits-header">
              <h4>Sub-Tasks</h4>
              <button class="add-sub-habit-btn" (click)="showAddSubHabitForm(habit.id)">
                <span class="btn-icon">â•</span>
                Add Sub-Task
              </button>
            </div>
            
            <!-- Add/Edit Sub-Habit Form -->
            <div *ngIf="showSubHabitForm[habit.id]" class="sub-habit-form">
              <form [formGroup]="subHabitForm" (ngSubmit)="saveSubHabit(habit.id)" class="form-inline">
                <div class="form-group">
                  <input
                    type="text"
                    formControlName="name"
                    placeholder="Sub-task name..."
                    [class.error]="subHabitForm.get('name')?.invalid && subHabitForm.get('name')?.touched">
                </div>
                <div class="form-group">
                  <input
                    type="text"
                    formControlName="description"
                    placeholder="Description (optional)...">
                </div>
                <div class="form-actions-inline">
                  <button type="submit" class="btn btn-sm btn-primary" [disabled]="subHabitForm.invalid">
                    {{ editingSubHabit ? 'Update' : 'Add' }}
                  </button>
                  <button type="button" class="btn btn-sm btn-cancel" (click)="hideAddSubHabitForm(habit.id)">
                    Cancel
                  </button>
                </div>
              </form>
            </div>
            
            <!-- Sub-Habits List -->
            <div class="sub-habits-list" *ngIf="habit.subHabits && habit.subHabits.length > 0">
              <div *ngFor="let subHabit of habit.subHabits" class="sub-habit-item" [class.inactive]="!subHabit.isActive">
                <div class="sub-habit-content">
                  <div class="sub-habit-name">{{ subHabit.name }}</div>
                  <div class="sub-habit-description" *ngIf="subHabit.description">{{ subHabit.description }}</div>
                </div>
                <div class="sub-habit-actions">
                  <button class="action-btn edit-btn" (click)="openEditSubHabitForm(habit, subHabit)" title="Edit sub-habit">
                    âœ
                  </button>
                  <button class="action-btn toggle-btn" 
                          [class.active]="subHabit.isActive"
                          (click)="toggleSubHabitActive(habit, subHabit)" 
                          [title]="subHabit.isActive ? 'Deactivate sub-habit' : 'Activate sub-habit'">
                    {{ subHabit.isActive ? 'â¸' : 'â–¶' }}
                  </button>
                  <button class="action-btn delete-btn" (click)="confirmDeleteSubHabit(habit, subHabit)" title="Delete sub-habit">
                    ğŸ—‘
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="habit-actions">
            <button class="action-btn sub-habits-btn" 
                    (click)="openSubHabitsManager(habit.id)"
                    title="Manage sub-habits">
              <span class="btn-icon">ğŸ“‹</span>
              Sub-Tasks
            </button>
            <button class="action-btn edit-btn" (click)="openEditForm(habit)" title="Edit habit">
              âœ
            </button>
            <button class="action-btn toggle-btn" 
                    [class.active]="habit.isActive"
                    (click)="toggleHabitActive(habit)" 
                    [title]="habit.isActive ? 'Pause habit' : 'Activate habit'">
              {{ habit.isActive ? 'â¸' : 'â–¶' }}
            </button>
            <button class="action-btn delete-btn" (click)="confirmDeleteHabit(habit)" title="Delete habit">
              ğŸ—‘
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Weekly Habits -->
    <div class="habit-category" *ngIf="getWeeklyHabits().length > 0">
      <div class="category-header">
        <h2>Weekly Habits</h2>
        <span class="habit-count">{{ getWeeklyHabits().length }}</span>
      </div>
      
      <div class="habits-grid">
        <div *ngFor="let habit of getWeeklyHabits()" class="habit-card weekly">
          
          <!-- Habit Header -->
          <div class="habit-header">
            <div class="habit-name-section">
              <div class="habit-name">{{ habit.name }}</div>
              <button 
                *ngIf="habit.hasSubHabits" 
                class="expand-btn"
                [class.expanded]="isHabitExpanded(habit.id)"
                (click)="toggleHabitExpansion(habit.id)"
                title="Toggle sub-habits">
                <span class="expand-icon">{{ isHabitExpanded(habit.id) ? 'â–¼' : 'â–¶' }}</span>
                <span class="sub-count">({{ habit.subHabits?.length || 0 }})</span>
              </button>
            </div>
            <div class="habit-status">
              <span class="status-badge" [class.active]="habit.isActive" [class.paused]="!habit.isActive">
                {{ habit.isActive ? 'ACTIVE' : 'PAUSED' }}
              </span>
            </div>
          </div>
          
          <div class="habit-description" *ngIf="habit.description">{{ habit.description }}</div>
          
          <div class="habit-meta">
            <div class="frequency-info">{{ habit.weeklyTarget }}x per week</div>
            <div class="duration-info" *ngIf="habit.estimatedDurationMinutes">
              <span class="duration-icon">â±</span>
              {{ formatDuration(habit.estimatedDurationMinutes) }}
            </div>
            <div class="deadline-info" *ngIf="habit.hasDeadline">{{ habit.deadlineTime }}</div>
          </div>
          
          <!-- Sub-Habits Section (Collapsible) -->
          <div *ngIf="isHabitExpanded(habit.id)" class="sub-habits-section">
            <div class="sub-habits-header">
              <h4>Sub-Tasks</h4>
              <button class="add-sub-habit-btn" (click)="showAddSubHabitForm(habit.id)">
                <span class="btn-icon">â•</span>
                Add Sub-Task
              </button>
            </div>
            
            <div *ngIf="showSubHabitForm[habit.id]" class="sub-habit-form">
              <form [formGroup]="subHabitForm" (ngSubmit)="saveSubHabit(habit.id)" class="form-inline">
                <div class="form-group">
                  <input type="text" formControlName="name" placeholder="Sub-task name..." 
                         [class.error]="subHabitForm.get('name')?.invalid && subHabitForm.get('name')?.touched">
                </div>
                <div class="form-group">
                  <input type="text" formControlName="description" placeholder="Description (optional)...">
                </div>
                <div class="form-actions-inline">
                  <button type="submit" class="btn btn-sm btn-primary" [disabled]="subHabitForm.invalid">
                    {{ editingSubHabit ? 'Update' : 'Add' }}
                  </button>
                  <button type="button" class="btn btn-sm btn-cancel" (click)="hideAddSubHabitForm(habit.id)">Cancel</button>
                </div>
              </form>
            </div>
            
            <div class="sub-habits-list" *ngIf="habit.subHabits && habit.subHabits.length > 0">
              <div *ngFor="let subHabit of habit.subHabits" class="sub-habit-item" [class.inactive]="!subHabit.isActive">
                <div class="sub-habit-content">
                  <div class="sub-habit-name">{{ subHabit.name }}</div>
                  <div class="sub-habit-description" *ngIf="subHabit.description">{{ subHabit.description }}</div>
                </div>
                <div class="sub-habit-actions">
                  <button class="action-btn edit-btn" (click)="openEditSubHabitForm(habit, subHabit)" title="Edit">âœ</button>
                  <button class="action-btn toggle-btn" [class.active]="subHabit.isActive"
                          (click)="toggleSubHabitActive(habit, subHabit)" 
                          [title]="subHabit.isActive ? 'Deactivate' : 'Activate'">
                    {{ subHabit.isActive ? 'â¸' : 'â–¶' }}
                  </button>
                  <button class="action-btn delete-btn" (click)="confirmDeleteSubHabit(habit, subHabit)" title="Delete">ğŸ—‘</button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="habit-actions">
            <button class="action-btn sub-habits-btn" (click)="openSubHabitsManager(habit.id)" title="Manage sub-habits">
              <span class="btn-icon">ğŸ“‹</span> Sub-Tasks
            </button>
            <button class="action-btn edit-btn" (click)="openEditForm(habit)" title="Edit habit">âœ</button>
            <button class="action-btn toggle-btn" [class.active]="habit.isActive"
                    (click)="toggleHabitActive(habit)" [title]="habit.isActive ? 'Pause habit' : 'Activate habit'">
              {{ habit.isActive ? 'â¸' : 'â–¶' }}
            </button>
            <button class="action-btn delete-btn" (click)="confirmDeleteHabit(habit)" title="Delete habit">ğŸ—‘</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Monthly Habits -->
    <div class="habit-category" *ngIf="getMonthlyHabits().length > 0">
      <div class="category-header">
        <h2>Monthly Habits</h2>
        <span class="habit-count">{{ getMonthlyHabits().length }}</span>
      </div>
      
      <div class="habits-grid">
        <div *ngFor="let habit of getMonthlyHabits()" class="habit-card monthly">
          <div class="habit-header">
            <div class="habit-name-section">
              <div class="habit-name">{{ habit.name }}</div>
              <button *ngIf="habit.hasSubHabits" class="expand-btn" [class.expanded]="isHabitExpanded(habit.id)"
                      (click)="toggleHabitExpansion(habit.id)" title="Toggle sub-habits">
                <span class="expand-icon">{{ isHabitExpanded(habit.id) ? 'â–¼' : 'â–¶' }}</span>
                <span class="sub-count">({{ habit.subHabits?.length || 0 }})</span>
              </button>
            </div>
            <div class="habit-status">
              <span class="status-badge" [class.active]="habit.isActive" [class.paused]="!habit.isActive">
                {{ habit.isActive ? 'ACTIVE' : 'PAUSED' }}
              </span>
            </div>
          </div>
          
          <div class="habit-description" *ngIf="habit.description">{{ habit.description }}</div>
          <div class="habit-meta">
            <div class="frequency-info">{{ habit.monthlyTarget }}x per month</div>
            <div class="duration-info" *ngIf="habit.estimatedDurationMinutes">
              <span class="duration-icon">â±</span> {{ formatDuration(habit.estimatedDurationMinutes) }}
            </div>
            <div class="deadline-info" *ngIf="habit.hasDeadline">{{ habit.deadlineTime }}</div>
          </div>
          
          <!-- Sub-Habits Section (same pattern) -->
          <div *ngIf="isHabitExpanded(habit.id)" class="sub-habits-section">
            <div class="sub-habits-header">
              <h4>Sub-Tasks</h4>
              <button class="add-sub-habit-btn" (click)="showAddSubHabitForm(habit.id)">
                <span class="btn-icon">â•</span> Add Sub-Task
              </button>
            </div>
            <div *ngIf="showSubHabitForm[habit.id]" class="sub-habit-form">
              <form [formGroup]="subHabitForm" (ngSubmit)="saveSubHabit(habit.id)" class="form-inline">
                <div class="form-group">
                  <input type="text" formControlName="name" placeholder="Sub-task name..." 
                         [class.error]="subHabitForm.get('name')?.invalid && subHabitForm.get('name')?.touched">
                </div>
                <div class="form-group">
                  <input type="text" formControlName="description" placeholder="Description (optional)...">
                </div>
                <div class="form-actions-inline">
                  <button type="submit" class="btn btn-sm btn-primary" [disabled]="subHabitForm.invalid">
                    {{ editingSubHabit ? 'Update' : 'Add' }}
                  </button>
                  <button type="button" class="btn btn-sm btn-cancel" (click)="hideAddSubHabitForm(habit.id)">Cancel</button>
                </div>
              </form>
            </div>
            <div class="sub-habits-list" *ngIf="habit.subHabits && habit.subHabits.length > 0">
              <div *ngFor="let subHabit of habit.subHabits" class="sub-habit-item" [class.inactive]="!subHabit.isActive">
                <div class="sub-habit-content">
                  <div class="sub-habit-name">{{ subHabit.name }}</div>
                  <div class="sub-habit-description" *ngIf="subHabit.description">{{ subHabit.description }}</div>
                </div>
                <div class="sub-habit-actions">
                  <button class="action-btn edit-btn" (click)="openEditSubHabitForm(habit, subHabit)" title="Edit">âœ</button>
                  <button class="action-btn toggle-btn" [class.active]="subHabit.isActive"
                          (click)="toggleSubHabitActive(habit, subHabit)" [title]="subHabit.isActive ? 'Deactivate' : 'Activate'">
                    {{ subHabit.isActive ? 'â¸' : 'â–¶' }}
                  </button>
                  <button class="action-btn delete-btn" (click)="confirmDeleteSubHabit(habit, subHabit)" title="Delete">ğŸ—‘</button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="habit-actions">
            <button class="action-btn sub-habits-btn" (click)="openSubHabitsManager(habit.id)" title="Manage sub-habits">
              <span class="btn-icon">ğŸ“‹</span> Sub-Tasks
            </button>
            <button class="action-btn edit-btn" (click)="openEditForm(habit)" title="Edit habit">âœ</button>
            <button class="action-btn toggle-btn" [class.active]="habit.isActive"
                    (click)="toggleHabitActive(habit)" [title]="habit.isActive ? 'Pause habit' : 'Activate habit'">
              {{ habit.isActive ? 'â¸' : 'â–¶' }}
            </button>
            <button class="action-btn delete-btn" (click)="confirmDeleteHabit(habit)" title="Delete habit">ğŸ—‘</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Seasonal Habits -->
    <div class="habit-category" *ngIf="getSeasonalHabits().length > 0">
      <div class="category-header">
        <h2>Seasonal Habits</h2>
        <span class="habit-count">{{ getSeasonalHabits().length }}</span>
      </div>
      
      <div class="habits-grid">
        <div *ngFor="let habit of getSeasonalHabits()" class="habit-card seasonal">
          <div class="habit-header">
            <div class="habit-name-section">
              <div class="habit-name">{{ habit.name }}</div>
              <button *ngIf="habit.hasSubHabits" class="expand-btn" [class.expanded]="isHabitExpanded(habit.id)"
                      (click)="toggleHabitExpansion(habit.id)" title="Toggle sub-habits">
                <span class="expand-icon">{{ isHabitExpanded(habit.id) ? 'â–¼' : 'â–¶' }}</span>
                <span class="sub-count">({{ habit.subHabits?.length || 0 }})</span>
              </button>
            </div>
            <div class="habit-status">
              <span class="status-badge" [class.active]="habit.isActive" [class.paused]="!habit.isActive">
                {{ habit.isActive ? 'ACTIVE' : 'PAUSED' }}
              </span>
            </div>
          </div>
          
          <div class="habit-description" *ngIf="habit.description">{{ habit.description }}</div>
          <div class="habit-meta">
            <div class="frequency-info">{{ habit.seasonalTarget }}x per season</div>
            <div class="duration-info" *ngIf="habit.estimatedDurationMinutes">
              <span class="duration-icon">â±</span> {{ formatDuration(habit.estimatedDurationMinutes) }}
            </div>
            <div class="deadline-info" *ngIf="habit.hasDeadline">{{ habit.deadlineTime }}</div>
          </div>
          
          <!-- Sub-Habits Section (same pattern) -->
          <div *ngIf="isHabitExpanded(habit.id)" class="sub-habits-section">
            <div class="sub-habits-header">
              <h4>Sub-Tasks</h4>
              <button class="add-sub-habit-btn" (click)="showAddSubHabitForm(habit.id)">
                <span class="btn-icon">â•</span> Add Sub-Task
              </button>
            </div>
            <div *ngIf="showSubHabitForm[habit.id]" class="sub-habit-form">
              <form [formGroup]="subHabitForm" (ngSubmit)="saveSubHabit(habit.id)" class="form-inline">
                <div class="form-group">
                  <input type="text" formControlName="name" placeholder="Sub-task name..." 
                         [class.error]="subHabitForm.get('name')?.invalid && subHabitForm.get('name')?.touched">
                </div>
                <div class="form-group">
                  <input type="text" formControlName="description" placeholder="Description (optional)...">
                </div>
                <div class="form-actions-inline">
                  <button type="submit" class="btn btn-sm btn-primary" [disabled]="subHabitForm.invalid">
                    {{ editingSubHabit ? 'Update' : 'Add' }}
                  </button>
                  <button type="button" class="btn btn-sm btn-cancel" (click)="hideAddSubHabitForm(habit.id)">Cancel</button>
                </div>
              </form>
            </div>
            <div class="sub-habits-list" *ngIf="habit.subHabits && habit.subHabits.length > 0">
              <div *ngFor="let subHabit of habit.subHabits" class="sub-habit-item" [class.inactive]="!subHabit.isActive">
                <div class="sub-habit-content">
                  <div class="sub-habit-name">{{ subHabit.name }}</div>
                  <div class="sub-habit-description" *ngIf="subHabit.description">{{ subHabit.description }}</div>
                </div>
                <div class="sub-habit-actions">
                  <button class="action-btn edit-btn" (click)="openEditSubHabitForm(habit, subHabit)" title="Edit">âœ</button>
                  <button class="action-btn toggle-btn" [class.active]="subHabit.isActive"
                          (click)="toggleSubHabitActive(habit, subHabit)" [title]="subHabit.isActive ? 'Deactivate' : 'Activate'">
                    {{ subHabit.isActive ? 'â¸' : 'â–¶' }}
                  </button>
                  <button class="action-btn delete-btn" (click)="confirmDeleteSubHabit(habit, subHabit)" title="Delete">ğŸ—‘</button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="habit-actions">
            <button class="action-btn sub-habits-btn" (click)="openSubHabitsManager(habit.id)" title="Manage sub-habits">
              <span class="btn-icon">ğŸ“‹</span> Sub-Tasks
            </button>
            <button class="action-btn edit-btn" (click)="openEditForm(habit)" title="Edit habit">âœ</button>
            <button class="action-btn toggle-btn" [class.active]="habit.isActive"
                    (click)="toggleHabitActive(habit)" [title]="habit.isActive ? 'Pause habit' : 'Activate habit'">
              {{ habit.isActive ? 'â¸' : 'â–¶' }}
            </button>
            <button class="action-btn delete-btn" (click)="confirmDeleteHabit(habit)" title="Delete habit">ğŸ—‘</button>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Delete Confirmation Modals -->
  
  <!-- Delete Habit Confirmation -->
  <div *ngIf="habitToDelete" class="modal-overlay" (click)="cancelDelete()">
    <div class="modal-content delete-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Delete Habit</h2>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete the habit "<strong>{{ habitToDelete.name }}</strong>"?</p>
        <p class="warning-text">This action cannot be undone and will also delete all associated sub-habits and completion history.</p>
      </div>
      <div class="modal-actions">
        <button class="btn btn-cancel" (click)="cancelDelete()">Cancel</button>
        <button class="btn btn-danger" (click)="deleteHabit()" [disabled]="loading">Delete Habit</button>
      </div>
    </div>
  </div>

  <!-- Delete Sub-Habit Confirmation -->
  <div *ngIf="subHabitToDelete" class="modal-overlay" (click)="cancelDelete()">
    <div class="modal-content delete-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Delete Sub-Habit</h2>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete the sub-habit "<strong>{{ subHabitToDelete.subHabit.name }}</strong>"?</p>
        <p class="warning-text">This action cannot be undone and will delete all completion history for this sub-habit.</p>
      </div>
      <div class="modal-actions">
        <button class="btn btn-cancel" (click)="cancelDelete()">Cancel</button>
        <button class="btn btn-danger" (click)="deleteSubHabit()" [disabled]="loading">Delete Sub-Habit</button>
      </div>
    </div>
  </div>

</div>